<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Questions</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">

    <link href="/css/global.css" rel="stylesheet"/>
    <style>

        /* Make table rows cleaner */
        table td {
            vertical-align: middle;
        }

        /* Action button group container */
        .action-buttons {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        /* Standardize button height + spacing */
        .action-buttons .btn {
            padding: 4px 10px;
            font-size: 12px;
            line-height: 1.2;
            border-radius: 8px;
        }

        /* Separate primary destructive actions */
        .btn-delete {
            background-color: #dc3545;
            color: white;
        }

        .btn-edit {
            background-color: #f4b942;
            color: black;
        }

        .btn-toggle {
            border: 1px solid #198754;
            color: #198754;
        }

        .btn-revise {
            border: 1px solid #0dcaf0;
            color: #0dcaf0;
        }

        .topic-badge {
            background-color: #5082d3;
            font-size: 0.75rem;
        }
    </style>


</head>

<body>

<div class="container py-4">

    <h2>All Questions</h2>

    <a href="/" class="btn btn-primary mb-3">Add New Question</a>
    <a href="/export/excel" class="btn btn-success mb-3">Export to Excel</a>


    <!-- Alerts -->
    <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
    <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>


    <!-- Filter Form -->
    <form method="get" class="row g-2 mb-3">

        <div class="col-md-3">
            <input class="form-control" name="search" th:value="${search}" placeholder="Searchâ€¦"/>
        </div>

        <div class="col-md-2">
            <label>
                <select class="form-select" name="difficulty" th:value="${difficulty}">
                    <option value="">All Difficulty</option>
                    <option value="EASY">EASY</option>
                    <option value="MEDIUM">MEDIUM</option>
                    <option value="HARD">HARD</option>
                </select>
            </label>
        </div>

        <div class="col-md-2">
            <input class="form-control" name="platform" th:value="${platform}" placeholder="Platform"/>
        </div>

        <div class="col-md-2">
            <input class="form-control" name="topic" th:value="${topic}" placeholder="Topic"/>
        </div>

        <div class="col-md-2">
            <input class="form-control" name="pattern" th:value="${pattern}" placeholder="Pattern"/>
        </div>

        <div class="col-md-1">
            <label>
                <select class="form-select"
                        name="size"
                        onchange="this.form.submit()">

                    <!-- Default label -->
                    <option value="5" th:selected="${size == 5}">5</option>
                    <option value="10" th:selected="${size == 10}">10</option>
                    <option value="20" th:selected="${size == 20}">20</option>
                    <option value="50" th:selected="${size == 50}">50</option>

                </select>
            </label>
        </div>
        <div class="col-md-2">
            <button class="btn btn-outline-primary w-100">Filter</button>
        </div>
        <div class="col-md-2">
            <a class="btn btn-outline-secondary w-100"
               th:href="@{/questions}">
                Reset
            </a>
        </div>

        <input type="hidden" name="page" value="0"/>
    </form>


    <!-- Table -->
    <div class="card shadow-sm">

        <div class="card-body">

            <table class="table table-striped align-middle table-hover table-responsive">

                <thead>
                <tr>
                    <th>VideoId</th>
                    <th>Problem</th>
                    <th>Platform</th>
                    <th>Difficulty</th>
                    <th>Topic</th>
                    <th>Pattern</th>
                    <th>Solved</th>
                    <th>Revise</th>
                    <th>Actions</th>
                </tr>
                </thead>

                <tbody>

                <tr th:each="q : ${questions}">
                    <td th:text="${q.videoId}"></td>
                    <td>
                        <a th:href="${q.problemLink}"
                           th:text="${q.problemName}"
                           target="_blank"
                           class="text-decoration-none fw-semibold">
                        </a>
                    </td>

                    <td th:text="${q.platform}"></td>
                    <td th:text="${q.difficultyLabel}"></td>
                    <td>
                        <span th:if="${q.topicNames != null}">
                            <span th:each="t : ${#strings.arraySplit(q.topicNames, ',')}"
                                  class="badge topic-badge me-1"
                                  th:text="${t}">
                            </span>
                        </span>
                    </td>


                    <td>
                        <span th:if="${q.patternNames != null}">
                            <span th:each="p : ${#strings.arraySplit(q.patternNames, ',')}"
                                  class="badge bg-secondary me-1"
                                  th:text="${p}">
                            </span>
                        </span>
                    </td>


                    <td>
                        <span class="badge"
                              th:classappend="${q.solved} ? 'bg-success' : 'bg-secondary'"
                              th:text="${q.solved} ? 'Solved' : 'Pending'">
                        </span>
                    </td>

                    <td th:text="${q.reviseCount}"></td>

                    <td>
                        <div class="action-buttons">

                            <a th:href="@{/solve/{id}(id=${q.id})}"
                               class="btn btn-toggle">
                                Toggle
                            </a>

                            <a th:href="@{/revise/{id}(id=${q.id})}"
                               class="btn btn-revise">
                                +Revise
                            </a>

                            <a th:href="@{/edit/{id}(id=${q.id})}"
                               class="btn btn-edit">
                                Edit
                            </a>

                            <a th:href="@{/delete/{id}(id=${q.id})}"
                               class="btn btn-delete">
                                Delete
                            </a>

                        </div>
                    </td>


                </tr>

                </tbody>

            </table>


            <!-- Pagination -->
            <nav th:if="${totalPages > 1}">
                <ul class="pagination">

                    <!-- Prev -->
                    <li class="page-item" th:classappend="${page == 0} ? 'disabled'">
                        <a class="page-link"
                           th:href="@{/questions(
                   page=${page - 1},
                   size=${size},
                   search=${search},
                   difficulty=${difficulty},
                   platform=${platform},
                   topic=${topic},
                   pattern=${pattern}
               )}">
                            Prev
                        </a>
                    </li>

                    <!-- Page Numbers -->
                    <li class="page-item"
                        th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                        th:classappend="${i == page} ? 'active'">

                        <a class="page-link"
                           th:text="${i + 1}"
                           th:href="@{/questions(
                   page=${i},
                   size=${size},
                   search=${search},
                   difficulty=${difficulty},
                   platform=${platform},
                   topic=${topic},
                   pattern=${pattern}
               )}">
                        </a>
                    </li>

                    <!-- Next -->
                    <li class="page-item" th:classappend="${page == totalPages - 1} ? 'disabled'">
                        <a class="page-link"
                           th:href="@{/questions(
                   page=${page + 1},
                   size=${size},
                   search=${search},
                   difficulty=${difficulty},
                   platform=${platform},
                   topic=${topic},
                   pattern=${pattern}
               )}">
                            Next
                        </a>
                    </li>

                </ul>
            </nav>


        </div>
    </div>

</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
</body>
</html>
